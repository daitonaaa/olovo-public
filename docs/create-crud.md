# Cоздание crud элементов

Для элементов с режимом запись, список записей (например новости)
предлагается использовать автоматическую генерацию crud моделей
для использования в административной интерфейсе и клиентской части.

Это позволяет:
- Просто описывать конфигурацию подобных модулей для разных частей системы в одном месте
- Исключить ручное дублирование кода для администратитативного интерфейса
- Исключить ручное дублирование API методов и сервисов
- Исключить ручное дублирование страниц для клиентского приложения


## Как это работает:


Допустим нам необходимо создать для сайта раздел новости. Посмотрим в целом что необходимо сделать
в разных частях системы по порядку

-----------
**Backend** 

-> Создать сущность БД

-> Описать конфигурацию

-> Сгенерировать и применить миграции

-> Сгенерировать вспомогательный код

-----------

**Client**

-> Создать вью компоненты для каждого представления

-> Запустить генерацию вспомогательного кода


-----------

**Admin**

-> Заполнить данными


-----------


Теперь рассмотрим более детально шаги:


### Backend

1) Создать новую crud сущность по пути `backend/src/sections-config/{name}`
Например `backend/src/sections-config/news`

Внутри папки создать два файла и наполнить их
- `entity.ts` - Описание обьекта БД
> Важно! Обязательно наследуйтесь от `EntityBase`
> Например: `export class MyEntity extends EntityBase {}`
- `index.ts` - Конфигурация crud


2) Сгенерировать миграции для новой сущности `npm run db:migrate {migrate-name}`
Например `npm run db:migrate add-news-crud`


3) Добавить созданный конфиг из `backend/src/sections-config/{name}/index.ts`
в обьект `crudModules` по адресу `backend/src/sections-config/index.ts`


4) Применить миграции `npm run build && npm run db:update`


5) Запустить генерацию crud сервисов и контроллеров `npm run generate:crud-services`

> Заметка: При изменении уже созданной сущности достаточно вызвать только
> перегенерацию


## Client

1) Создать внутри папки `sections` соотвествующие компоненты
Для каждой сущности необходимо завести 

- `__crud_{EntityName}_ShortList` - Вью для мини виджета со списком записей
- `__crud_{EntityName}_Single` - Вью для карточки записи

> Компоненты должны быть экспортированы по умолчанию, 
> необходимо для стандартизации ленивой загрузки

#### Пример
Путь до файла: `sections/__crud_project_Single/index.tsx`

Код: 
```typescript
import React from 'react';

const __crud_project_Single = (props: any) => {

  return (
    <>
      <h4>Crud item instance</h4>
      <div>project single: {props.item.title}</div>
    </>
  )
}

export default __crud_project_Single;

```

2) Запустить сбор (кодогенерацию) всех `sections` в `sections/index.ts` для формирования конфигурации
динамических импортов с помощью команды `npm run sections:generate`

> Файл `sections/index.ts` генерируется автоматически, не стоит руками там что то менять

> Кодогенерация так же запускается каждый раз при старте в режиме `dev`, но если вы уже в нем то стоит пересобраться


3) Сверстать вью компонент с ипользованием [параметров crud](./crud-client-settings.md)


## Admin UI

В административном интерфейсе автоматически появится новый раздел
